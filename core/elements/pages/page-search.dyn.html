<dom-module id="page-search">
  <template>
    <style>
      paper-card.post {
        --paper-card-header-image: {
          max-height: 400px;
        }
        --paper-card-header-text: {
          font-size: 38px;
        }
        --paper-card-header-image-text: {
          font-size: 38px;
          text-shadow: 0 0 3px #000000;
        }
      }
      paper-card.white {
        --paper-card-header-color: #ffffff;
      }
    </style>

    <paper-card>
      <div class="card-content">
        <paper-input is="iron-input" label="Search" value="[[query]]" bind-value="{{query}}"></paper-input>
      </div>
    </paper-card>

    <template is="dom-repeat" items="{{posts}}" as="post">
      <!-- Contains featured image -->
      <template is="dom-if" if="[[post.featuredImage]]">
        <paper-card heading="[[post.title]]" on-click="goToPost" image="../images/uploads/[[post.featuredImage]]" class="white">
          <div class="card-content">[[post.summary]]</div>
          <div class="card-actions">
            <paper-button on-click="goToPost">Read More</paper-button>
          </div>
        </paper-card>
      </template>

      <!-- Doesn't contain featured image -->
      <template is="dom-if" if="[[!post.featuredImage]]">
        <paper-card heading="[[post.title]]" on-click="goToPost">
          <div class="card-content">[[post.summary]]</div>
          <div class="card-actions">
            <paper-button on-click="goToPost">Read More</paper-button>
          </div>
        </paper-card>
      </template>
    </template>

  </template>

  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'page-search',

        properties: {
          query: {
            type: String,
            observer: '_updatedSearch'
          }
        },

        ready: function() {
          this.posts = [];
        },

        goToPost: function(e) {
          var model = e.model;
          app.goTo('/posts/' + model.post.permalink);
        },

        _updatedSearch: function() {
          this.set('posts', []);
          if (this.query !== '') {
            for (var i = 0; i < app.posts.length; i++) {
              if (app.posts[i].title.toLowerCase().indexOf(this.query.toLowerCase()) !== -1) { // matches search
                console.log('Item found :)');
                this.push('posts', app.posts[i]);
              }
              console.log(this.posts);
            }
          }
        }
      });
    })();
  </script>

</dom-module>
