"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),ModDisqus=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"beforeRegister",value:function(){this.is="mod-disqus",this.properties={post:{type:Object}}}},{key:"ready",value:function(){this.set("moduleSettings",app.getModuleSettings(this.is))}},{key:"attached",value:function(){var t=this;if(this.post){var e=this.generatePage();window.disqus_config?(window.DISQUS.reset({reload:!0,config:function(){this.page=e}}),window.DISQUS.reset({reload:!0,config:function(){this.page=e}}),this.set("loaded",!0)):(window.disqus_config=function(){this.page=e},this.injectScript().then(function(){window.DISQUS.reset({reload:!0,config:function(){this.page=e}}),t.set("loaded",!0)}).catch(function(t){return app.handleError}))}}},{key:"injectScript",value:function(){var t=(this.https?"https":"http")+"://"+this.moduleSettings.shortname+".disqus.com";return new Promise(function(e,n){var i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src=t+"/embed.js",i.dataTimestamp=new Date,i.onload=e,i.onerror=n,(document.head||document.body).appendChild(i)}).then(function(){return new Promise(function(e,n){var i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src=t+"/count.js",i.onload=e,i.onerror=n,(document.head||document.body).appendChild(i)})})}},{key:"generatePage",value:function(){return{identifier:this.identifier||this.post.taxonomy.name+this.post.slug.replace("-",""),title:this.title||(this.post.title?this.post.title:""),url:this.url||window.location.href,category_id:this.category||""}}}]),t}();Polymer(ModDisqus);